<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcación GPEM S.A.C</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <main class="contenedor">
        <!-- Sección DNI y botones de asistencia-refrigerio -->
        <section class="seccion-dni">
            <h2 class="titulo-seccion">Ingresar DNI</h2>
            <div class="contenedor-input">
                <label for="nroDni">N° DNI</label>
                <input type="tel" id="nroDni">
            </div>
            
            <div class="grupo-botones">
                <button class="boton-asistencia" id="btnAsistencia">Asistencia</button>
                <button class="boton-refrigerio" id="btnRefrigerio">Refrigerio</button>
            </div>
        </section>

        <!-- Sección información del usuario -->
        <section class="seccion-informacion">
            <h2 class="titulo-seccion">Información del usuario</h2>
            <div class="contenedor-foto">
                <img src="img/foto.png" alt="Foto del usuario">
            </div>
            <div class="contenedor-datos">
                <article class="dato">
                    <label for="codigo">Código</label>
                    <input type="text" id="codigo" value="" disabled>
                </article>
                <article class="dato">
                    <label for="nombre">Nombres</label>
                    <input type="text" id="nombre" value="" disabled>
                </article>
                <article class="dato">
                    <label for="apellido">Apellidos</label>
                    <input type="text" id="apellido" value="" disabled>
                </article>
                <article class="dato">
                    <label for="dni">DNI</label>
                    <input type="text" id="dni" value="" disabled>
                </article>
                <article class="dato">
                    <label for="cargo">Cargo</label>
                    <input type="text" id="cargo" value="" disabled>
                </article>
            </div>
        </section>
        
        <!-- Sección registro de actividades -->
        <section class="seccion-registro">
            <h2 class="titulo-seccion">Registro de actividades</h2>
            <div class="contenedor-fecha-horario">
                <label class="etiqueta-fecha">Fecha:</label> 
                <input class="entrada-fecha" id="entrada-fecha" disabled value=""/>
                <label class="etiqueta-horario">Horario:</label>
                <input class="entrada-horario" disabled value="18:00:00"/>
            </div>
            <div class="grupo-botones-registro">
                <button class="boton-registro boton-ingreso-labores inactivo" id="btnIngresoLabores">Ingreso labores</button>
                <button class="boton-registro boton-ingreso-refrigerio inactivo" id="btnIngresoRefrigerio">Ingreso refrigerio</button>
                <button class="boton-registro boton-salida-refrigerio inactivo" id="btnSalidaRefrigerio">Salida refrigerio</button>
                <button class="boton-registro boton-salida-labores inactivo" id="btnSalidaLabores">Salida labores</button>
            </div>
        </section>

        <!-- Hora y Fecha Actual -->
        <section class="seccion-hora-fecha">
            <time id="horaActual"></time>
            <time id="fechaActual"></time>
        </section>
    </main>
 
    <!-- Botones ingresar y salir -->
    <div id="modal" class="modal">
        <div class="modal-contenido">
            <span class="cerrar">&times;</span>
            <section class="seccion-ingresar-salir">
                <div class="grupo-botones-registro modificador-botones">
                    <button class="boton-ingreso boton-ingreso-lab" id="modalBtnIngresoLabores">Ingreso Labores</button>
                    <button class="boton-salida boton-salida-lab" id="modalBtnSalidaLabores">Salida Labores</button>
                    <button class="boton-ingreso boton-ingreso-ref" id="modalBtnIngresoRefrigerio">Ingreso Refigerio</button>
                    <button class="boton-salida boton-salida-ref" id="modalBtnSalidaRefrigerio">Salida Refrigerio</button>
                </div>
            </section>
        </div>
    </div>

    <script>
        // OBJETOS QUE SIMULAN CONSUMO DE BASE DE DATOS
        const personal = [
            {
                pers_codigo: 1,
                idcargo:1,
                idarea:1,
                pers_nombres: "Fernando Edilberto",
                pers_apellidos: "Hernández Gonzales",
                pers_alias:"fernando",
                pers_dni: "50505050",
                pers_fechaIngreso: "2024-01-01",
                pers_fechaNac: "1980-01-01",
                pers_direccion: "Dirección 100",
                pers_telefono:"989898989",
                pers_telefono2:"979798987",
                pers_fechaCese:"2024-02-10",
                pers_motivoCese:"Solicitud",
                pers_estado:2,
                pers_nivel:null,
                bib_acceso: 1,
                ccrh:0,
                pers_actualizacion:null
            },
            {
                pers_codigo: 2,
                idcargo:2,
                idarea:1,
                pers_nombres: "Maria Fernanda",
                pers_apellidos: "Perez Lopez",
                pers_alias:"maria",
                pers_dni: "40404040",
                pers_fechaIngreso: "2024-02-01",
                pers_fechaNac: "1988-02-01",
                pers_direccion: "Dirección 200",
                pers_telefono:"979797979",
                pers_telefono2:"960606060",
                pers_fechaCese:"2024-06-10",
                pers_motivoCese:"Solicitud",
                pers_estado:2,
                pers_nivel:null,
                bib_acceso: 1,
                ccrh:0,
                pers_actualizacion:null
            }
        ]

        const marcaciones=[
            {
                idmarcacion:1,
                idpersonal:1,
                idturno:1,
                fecha:"2024-06-13",
                condicion:1,
                turnoinicio: "08:00:00",
                turnofinl:"18:00:00",
                programacion1:"2024-06-13 08:00:00",
                programacion2:"2024-06-13 18:00:00",
                asistencia1:null,
                asistencia2:null,
                desayuno1:null,
                desayuno2:null,
                refrigerio1:null,
                refrigerio2:null,
                tecnicosino:0,
                estado:0,
                observacion:null,
                ccnivel:51,
                actualizacion:null,
                gps_direccion:null,
                gps_longitud:null,
                gps_latitud:null
            }
        ]

        const areas =[
            {
                idarea: 1,
                area: "Sistemas",
                estado: 2,
                usuario: null
            },
            {
                idarea: 2,
                area: "Administracion",
                estado: 2,
                usuario: null
            }
        ]

        const cargos =[
            {
                idcargo: 1,
                idarea : 1,
                cargo : "Programador",
                estado: 2,
                usuario:null
            },
            {
                idcargo: 2,
                idarea : 1,
                cargo : "Analista TI",
                estado: 2,
                usuario:null
            }
        ]

        const turnos =[
            {
                idturno : 1,
                turno :"diurno",
                idturnomtn : 0,
                horainicio : "08:00:00",
                horafin : "18:00:00",
                cambiodia : 0,
                tipo : 0,
                bancohrs : 0,
                estado : 2,
                actualizacion: 1
            }
        ]

        //FUNCIÓN PARA OBTENER INFORMACIÓN DE CADA COLABORADOR (ÁREA,CARGO, MARCACIONES,ETC.)
        const getPersonalDetails = (dniPersonal) => {
            //BUSCAR COLABORADOR POR SU ID
            const person = personal.find(p => p.pers_dni === dniPersonal);
            //VALIDANDO SI EXISTE COLABORADOR
            if (!person) {
                console.warn("El DNI ingresado no existe");
                return null;
            }
            //SE OBTIENE LOS CARGOS
            const cargo = cargos.find(c => c.idcargo === person.idcargo);
            //SE OBTIENE LAS ÁREAS
            const area = areas.find(a => a.idarea === person.idarea);
            // SE OBTIENE LAS MARCACIONES A TRAVÉS DEL ID PERSONA
            const marcacion = marcaciones.filter(m => m.pers_dni === dniPersonal);

            return { 
                ...person,
                cargo: cargo ? cargo.cargo : null,
                area: area ? area.area : null,
                marcaciones: marcacion
            };
        }
        console.log(getPersonalDetails(1));

        // OBTIENE INFORMACIÓN DE COLABORADOR POR DNI Y VALIDA EL BOTÓN DE MARCACIÓN
        const consultarDni = () => {
            const dni = document.querySelector('#nroDni').value.trim();

            if(dni == ''){
                console.warn('Por favor, ingrese un DNI.')
                return;
            }
            const detalleColaborador = getPersonalDetails(dni);

            if (detalleColaborador) {
                // Mostrar información en los campos correspondientes
                document.getElementById('codigo').value = detalleColaborador.pers_codigo;
                document.getElementById('nombre').value = detalleColaborador.pers_nombres;
                document.getElementById('apellido').value = detalleColaborador.pers_apellidos;
                document.getElementById('dni').value = detalleColaborador.pers_dni;
                document.getElementById('cargo').value = detalleColaborador.cargo;

                // Habilitar botones según las marcaciones o el estado del colaborador, por ejemplo:
                // Aquí se debería implementar la lógica para habilitar/deshabilitar botones según las marcaciones o el estado del colaborador

                console.log(detalleColaborador);
            }
        }
        
        document.addEventListener('change',consultarDni);







        // BOTONES PRINCIPALES
        const btnAsistencia = document.querySelector('#btnAsistencia');
        const btnRefrigerio = document.querySelector('#btnRefrigerio');
        
        // BOTONES PARA FUNCIONALIDAS DE MODAL
        const modal = document.getElementById("modal");
        const span = document.getElementsByClassName("cerrar")[0];
        
        // INICIALIZANDO MODAL EN NONE.
        modal.style.display = "none";

        // FUNCIÓN PARA MOSTRAR/OCULTAR BOTONES
        const toggleButtons = (ingresoClass, salidaClass, show) => {
            const action = show ? 'remove' : 'add';
            document.querySelector(ingresoClass).classList[action]('hidden');
            document.querySelector(salidaClass).classList[action]('hidden');
        }

        // FUNCIÓN PARA REMOVER LA CLASE 'hidden' DE LOS BOTONES
        const removeHiddenClass = () => {
            const hiddenButtons = document.querySelectorAll('.hidden');
            hiddenButtons.forEach(button => button.classList.remove('hidden'));
        }

        // FUNCIÓN QUE AGREGA ATTRIBUTE 'disabled' A ELEMENTO QUE SE LE PASA SU 'Id'
        const setAttributeButton = (id) => {
            document.querySelector(id).setAttribute("disabled", "disabled");
        }

        // EVENTO CLICK PARA EL BOTÓN DE ASISTENCIA
        btnAsistencia.addEventListener('click', () => {
            modal.style.display = 'flex';
            toggleButtons('.boton-ingreso-ref', '.boton-salida-ref', false);
            toggleButtons('.boton-ingreso-lab', '.boton-salida-lab', true);
            // setAttributeButton("#modalBtnSalidaLabores");
        });

        // EVENTO CLICK PARA EL BOTÓN DE REFRIGERIO
        btnRefrigerio.addEventListener('click', () => {
            modal.style.display = 'flex';
            toggleButtons('.boton-ingreso-lab', '.boton-salida-lab', false);
            toggleButtons('.boton-ingreso-ref', '.boton-salida-ref', true);
        });

        // EVENTO PARA CERRAR EL MODAL
        span.onclick = function() {
            modal.style.display = "none";
            removeHiddenClass();
        }

        // EVENTO PARA CERRAR EL MODAL AL DAR CLICK FUERA DEL MODAL
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                removeHiddenClass();
            }
        }

    
        /*  ===========================================
            FUNCIONALIDADES PARA LOS BOTONES DEL MODAL
            ===========================================
        */
        const obtenerFechaActualCorta = () => {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date().toLocaleDateString('es-ES', options);
        }

        const removeInactiveClass = (id) => {
            document.querySelector(id).classList.remove('inactivo'); 
        }

        /*ACTIVIDADES DE BOTONES LABORES :*/
        /* INGRESO:*/
        document.getElementById("modalBtnIngresoLabores").addEventListener('click',()=>{
            let currentDate = document.querySelector("#entrada-fecha");
            currentDate.value = obtenerFechaActualCorta();
            modal.style.display = "none";
            //ACTIVACIÓN DE BOTON: INGRESO LABORES
            removeInactiveClass("#btnIngresoLabores");
        });
        /* SALIDA :*/
        document.getElementById("modalBtnSalidaLabores").addEventListener('click',()=>{
            //let currentDate = document.querySelector("#entrada-fecha");
            //currentDate.value = obtenerFechaActualCorta();
            modal.style.display = "none";
            //ACTIVACIÓN DE BOTON: INGRESO LABORES
            removeInactiveClass("#btnSalidaLabores");

        });
        
        /*ACTIVIDADES DE BOTONES REFRIGERIO : */ 
        /* INGRESO:*/
        document.getElementById("modalBtnIngresoRefrigerio").addEventListener('click',()=>{
            //let currentDate = document.querySelector("#entrada-fecha");
            //currentDate.value = obtenerFechaActualCorta();
            modal.style.display = "none";
            //ACTIVACIÓN DE BOTON: INGRESO LABORES
            removeInactiveClass("#btnIngresoRefrigerio");
        });
        /* SALIDA :*/
        document.getElementById("modalBtnSalidaRefrigerio").addEventListener('click',()=>{
            //let currentDate = document.querySelector("#entrada-fecha");
            //currentDate.value = obtenerFechaActualCorta();
            modal.style.display = "none";
            //ACTIVACIÓN DE BOTON: INGRESO LABORES
            removeInactiveClass("#btnSalidaRefrigerio");
        });

        /*  ==========================
            HORA Y FECHA ACTUAL
            ==========================
        */ 
        // Función para obtener la hora actual en formato AM/PM
        const obtenerHoraActual = () => {
            const ahora = new Date();
            let horas = ahora.getHours();
            let minutos = ahora.getMinutes();
            const ampm = horas >= 12 ? 'p.m.' : 'a.m.';
            horas = horas % 12;
            horas = horas ? horas : 12; // las 0 horas se convierten a 12
            minutos = minutos < 10 ? '0' + minutos : minutos;
            return horas + ':' + minutos + ' ' + ampm;
        }

        // Función para obtener la fecha actual en formato día de la semana, día, mes y año
        const obtenerFechaActual = () => {
            const opcionesFecha = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date().toLocaleDateString('es-ES', opcionesFecha);
        }

        // Actualizar la hora y fecha actual cada segundo
        const actualizarHoraFecha = () => {
            const horaActualElemento = document.getElementById('horaActual');
            const fechaActualElemento = document.getElementById('fechaActual');

            horaActualElemento.textContent = obtenerHoraActual();
            fechaActualElemento.textContent = obtenerFechaActual();
        }

        // Actualizar la hora y fecha actual inicialmente
        actualizarHoraFecha();

        // Actualizar cada segundo
        setInterval(actualizarHoraFecha, 1000);
        
        


    </script>
</body>
</html>